# HOPE 工具箱（Adobe Illustrator CEP 扩展）

适用于 Adobe Illustrator 的实用面板，集成高频工作流脚本：对齐、布局、测量、文本与图像处理、创意效果等，开箱即用，支持自定义分类与快捷键。

## 项目信息

- **扩展包 ID**：`com.hope.toolbox`
- **扩展 ID**：`com.hope.toolbox.panel`
- **面板名称**：`HOPE 工具箱`
- **支持主机**：Illustrator (`ILST`，版本 ≥ 17.0 / CC 2013+)

## 核心特性

- ⚡ **动态加载**：从 `assets/userSettings.json` 读取工具与分类，无需修改 HTML
- 🕒 **最近使用**：自动记录常用工具，快速访问（最多 10 个）
- ⌨️ **快捷键支持**：单键触发工具，无需鼠标点击
- 📝 **详细日志**：内置日志系统，方便调试和错误追踪
- 🎨 **现代界面**：深色主题，响应式设计

## 兼容性

- Windows / macOS
- Illustrator 17.0+（CC 2013 及以上）
- 需要启用 CEP 调试模式

## 安装步骤

### 1. 复制扩展文件

将整个 `com.hope.toolbox` 文件夹复制到 CEP 扩展目录：

- **Windows**：`C:\Users\{用户名}\AppData\Roaming\Adobe\CEP\extensions\`
- **macOS**：`~/Library/Application Support/Adobe/CEP/extensions/`

### 2. 启用调试模式

允许未签名扩展运行：

#### Windows 方法（推荐）：
双击项目根目录的 `绕过adobe插件未签名.reg` 文件，或手动添加注册表项：
```
HKEY_CURRENT_USER\Software\Adobe\CSXS.9\PlayerDebugMode = "1"
HKEY_CURRENT_USER\Software\Adobe\CSXS.10\PlayerDebugMode = "1"
HKEY_CURRENT_USER\Software\Adobe\CSXS.11\PlayerDebugMode = "1"
```

#### macOS 方法：
在终端执行（根据已安装的 Illustrator 版本）：
```bash
defaults write com.adobe.CSXS.9 PlayerDebugMode 1
defaults write com.adobe.CSXS.10 PlayerDebugMode 1
defaults write com.adobe.CSXS.11 PlayerDebugMode 1
```

### 3. 重启 Illustrator

重启后在菜单栏选择：`窗口 > 扩展 > HOPE 工具箱`

## 使用说明

1. **打开面板**：Illustrator 菜单栏 → 窗口 → 扩展 → HOPE 工具箱
2. **选择工具**：
   - 点击工具按钮执行
   - 或按快捷键（显示在按钮右上角）
3. **切换分类**：点击左侧导航图标
4. **查看最近使用**：点击顶部时钟图标 🕒
5. **搜索工具**：使用顶部搜索框快速定位

## 工具列表（按分类）

### ⚡ 快捷操作
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 一键转曲 | `O` | 将文本和对象转换为轮廓/曲线 |
| 水平分布间距0 | `H` | 水平平均分布并对齐到关键对象 |
| 垂直分布间距0 | `J` | 垂直平均分布并对齐到关键对象 |
| 逆时针旋转90° | `Q` | 将选中对象逆时针旋转90度 |
| 顺时针旋转90° | `W` | 将选中对象顺时针旋转90度 |
| 水平翻转 | `F` | 水平翻转选中对象 |
| 垂直翻转 | `V` | 垂直翻转选中对象 |
| 居中对齐 | `Z` | 在当前画板中居中对齐 |
| 锁定对象 | `L` | 锁定选中的对象 |
| 解锁所有对象 | `U` | 解锁文档中所有已锁定的对象 |
| 扩展外观 | `E` | 扩展选中对象的外观（效果、描边等） |

### 📋 画板工具
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 按画板创建矩形 | `1` | 根据当前画板尺寸创建矩形 |
| 按图形创建画板 | `2` | 根据选中图形创建新画板 |
| 批量重命名画板 | `3` | 批量修改画板名称、添加前缀/后缀/尺寸 |
| 显示画板名称 | `4` | 显示画板名称和尺寸 |
| 导出PDF | `5` | 导出当前画板为PDF |
| 导出PLT | - | 导出为PLT绘图仪格式（HPGL） |

### 📐 排列与布局
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| **等比缩放到指定尺寸** | - | 对话框操作，支持按尺寸（约束宽度/高度）或按比例缩放，无多余弹窗 |
| 重复排列 | `R` | 重复选中对象，支持预设和自定义 |
| 添加裁切标记 | `C` | 在选中对象周围添加裁切标记 |
| 快速排版 | `Y` | 将选中的对象排列在指定尺寸的画板上 |
| 和谐排列 | `6` | 将选中的对象高效排列在指定尺寸的矩形中 |
| 简易物料排版 | `7` | 排列在指定板材上，超出自动创建新画板 |
| 重新排列对象 | `8` | 重新排列选中对象 |

### 📏 测量与标注
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 快速标注尺寸 | `D` | 在选中对象左上角添加尺寸标注 |
| 测量路径长度 | `M` | 计算选中路径的总长度 |
| 面积周长计算 | `S` | 计算选中对象的面积和周长 |
| 尺寸标注 | `X` | 为选中对象添加尺寸标注 |
| 统计对象数量 | `9` | 统计选中对象的数量 |

### 📝 文本工具
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 批量文本编辑 | `B` | 批量编辑文本对象 |
| 批量替换文本 | `T` | 批量替换文本内容 |
| 自动编号 | `N` | 为选中对象自动添加编号 |

### 🖼️ 图像处理
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 一键嵌入图像 | `I` | 将链接图像转为嵌入 |
| 内联SVG转AI | `0` | 将内联SVG转换为AI对象 |
| 打开PDF | `P` | 打开PDF文件 |
| **查找相近专色** | - | 提取选中对象颜色，在4594个专色中查找最相近的（PANTONE/RAL/NIPPON），使用Delta E 2000算法 |
| **批量转换为专色** | - | 扫描文档中所有颜色，批量转换为最接近的专色（支持色库筛选） |
| **导出专色清单** | - | 生成文档中所有专色的详细清单，用于印刷报价和存档 |

### ✨ 创意效果
| 工具 | 快捷键 | 说明 |
|------|--------|------|
| 随机填充 | - | 随机填充颜色 |
| 随机化对象 | - | 随机化对象属性 |
| 替换项目 | - | 批量替换项目 |
| 故障艺术 | `G` | 生成故障艺术效果 |
| 元球效果 | - | 生成元球混合效果 |
| 弧形扭曲 | `A` | 弧形扭曲变形 |
| 外接圆 | - | 生成多边形外接圆 |
| 裁剪工具 | `K` | 使用第一个对象裁剪其他对象 |

## 等比缩放工具

快速将选中对象等比缩放到指定尺寸或比例，支持单个或多个对象整体缩放。

### 功能特点
- **按尺寸缩放**：精确控制宽度或高度，另一维度自动等比调整
- **按比例缩放**：直接输入百分比，快速放大/缩小
- **自动单位识别**：使用文档默认单位（mm、cm、pt、inch等）
- **简洁操作**：一个对话框完成操作，无多余提示

### 使用方法

1. 选中一个或多个对象
2. 运行"等比缩放到指定尺寸"工具
3. 在对话框中选择缩放模式：
   - **按尺寸**：
     - 选择约束维度（宽度/高度）
     - 输入目标值（如 50）
     - 自动等比缩放
   - **按比例**：
     - 输入缩放百分比（如 80 = 缩小到80%，150 = 放大到150%）
4. 点击确定完成

### 典型场景

**场景1：Logo规范尺寸**
- 需求：Logo宽度必须是50mm
- 操作：选"按尺寸" → "宽度" → 输入 `50` → 确定

**场景2：整体缩小**
- 需求：设计稿整体缩小到80%
- 操作：选"按比例" → 输入 `80` → 确定

**场景3：高度对齐**
- 需求：多个元素高度统一为100mm
- 操作：全选 → 选"按尺寸" → "高度" → 输入 `100` → 确定

---

## 专色工具套件

HOPE工具箱提供了一套完整的专色处理解决方案，覆盖从查找、转换到导出的全流程：

### 1. 查找相近专色
**适用场景**：单个对象的精确专色匹配
- 从选中对象提取颜色（支持分别提取填充/描边）
- 在4594个专色中查找最相近的10个（PANTONE/RAL/NIPPON）
- 支持色库筛选（只搜索需要的色库）
- 实时预览效果
- 自动创建专色色板
- 使用**Delta E 2000算法**（印刷行业标准）

### 2. 批量转换为专色
**适用场景**：整个文档的批量专色转换
- 自动扫描文档中所有RGB/CMYK颜色
- 为每种颜色找到最接近的专色
- 显示颜色映射表供用户确认
- 一键批量应用转换
- 生成转换报告（转换了多少颜色、多少对象）

### 3. 导出专色清单
**适用场景**：印刷报价和项目存档
- 扫描文档中所有使用的专色
- 统计每个专色的使用次数（填充/描边分开统计）
- 生成详细清单（色号、CMYK、RGB、HEX）
- 导出为TXT文件
- 可直接发送给印刷厂报价

### 典型工作流程

**流程1：设计稿转印刷**
1. 使用"批量转换为专色" → 将所有RGB颜色转为专色
2. 使用"导出专色清单" → 生成印刷用色卡
3. 发送给印刷厂确认和报价

**流程2：品牌色匹配**
1. 选中品牌色对象
2. 使用"查找相近专色" → 找到最接近的PANTONE色号
3. 预览效果并应用

**流程3：项目存档**
1. 使用"导出专色清单" → 生成专色使用记录
2. 随项目文件一起存档
3. 方便未来复用和查询

### 技术亮点

- **Delta E 2000算法**：CIE2000色差公式，符合人眼感知，印刷行业认可
- **真专色色板**：自动创建Spot Color类型色板，使用CMYK值，适合印刷
- **色库筛选**：根据项目需求选择色库，提升搜索效率
- **批量处理**：支持大型文档的批量转换
- **详细统计**：完整的使用次数和颜色信息

## 自定义配置

编辑 `assets/userSettings.json` 可以：
- 添加/删除工具
- 修改工具分类
- 自定义快捷键
- 调整工具顺序

修改后保存文件，面板会在 5 秒内自动刷新。

## 调试方法

### 查看浏览器控制台：
1. 在 Illustrator 中打开面板
2. 右键点击面板 → 检查元素（需先启用调试模式）
3. 查看 Console 标签页的日志输出

### 查看本地日志：
打开浏览器控制台，执行：
```javascript
JSON.parse(localStorage.getItem('debugLogs'))
```

## 常见问题

**Q: 工具点击没反应？**
- 确保 Illustrator 中有打开的文档
- 检查是否选中了必要的对象
- 查看浏览器控制台的错误信息

**Q: 快捷键不生效？**
- 确保焦点在面板上（不在输入框中）
- 检查是否与其他插件冲突

**Q: 面板无法加载？**
- 确认已启用调试模式
- 检查扩展文件夹路径是否正确
- 重启 Illustrator

## 项目结构

```
com.hope.toolbox/
├── .debug                      # CEP 调试配置
├── .gitignore                  # Git 忽略规则
├── CSXS/
│   └── manifest.xml           # CEP 扩展清单
├── assets/
│   └── userSettings.json      # 工具配置文件
├── css/
│   └── styles.css             # 样式表
├── js/
│   ├── CSInterface.js         # CEP 接口库
│   ├── Vulcan.js              # Adobe 辅助库
│   ├── main.js                # 主逻辑（含日志系统）
│   └── scripts/               # JSX 脚本文件夹
├── index.html                 # 面板入口
└── README.md                  # 本文档
```

## 开发贡献

欢迎提交 Issue 和 Pull Request！

开发时建议：
1. 遵循现有代码风格
2. 在 `js/scripts/` 中添加新脚本
3. 更新 `userSettings.json` 配置
4. 测试后再提交

## 版本历史

### v1.1.0（当前版本）
- ✅ 核心功能实现
- ✅ 60+ 实用工具
- ✅ 快捷键支持
- ✅ 日志系统
- ✅ 最近使用记录
- ✨ 新增：等比缩放到指定尺寸工具
  - 支持按尺寸缩放（约束宽度/高度）
  - 支持按比例缩放（输入百分比）
  - 简洁对话框，无多余弹窗
- 🔧 优化：专色查找支持CMYK模式智能匹配
  - 自动检测文档色彩模式（RGB/CMYK）
  - CMYK模式下直接用CMYK值匹配，避免转换误差
  - 提升匹配准确度

### v1.0.0
- ✅ 初始版本发布

## 许可证

内部工具，仅供 HOPE 团队使用。

---

**技术支持**：如遇问题，请查看浏览器控制台日志或联系开发团队。
